# Обзор конфигурации V2

Для развёртывания кластера {{ ydb-short-name }}, добавления в кластер новых узлов и изменения параметров требуется конфигурация.

{% include [new](_includes/new.md) %}

Конфигурация кластера {{ ydb-short-name }} представляет собой текстовый файл в формате [YAML](https://en.wikipedia.org/wiki/YAML), интерпретация которого более подробно описана в статье [{#T}](dynamic-config-selectors.md).

Конфигурация описывает настройки кластера {{ ydb-short-name }}. Конфигурационный файл содержит различные параметры, необходимые для запуска и настройки узлов кластера. Подробнее о параметрах можно узнать в [справке по конфигурации](config-settings.md). Часть параметров вступает в силу на узле сразу после того, как изменённая конфигурация будет доставлена туда через CMS, а часть — только после перезапуска узла.

Конфигурация кластера {{ ydb-short-name }} хранится в нескольких разных местах:

- в виде набора файлов конфигурации узла в файловой системе каждого узла {{ ydb-short-name }} (необходим для использования в момент запуска узла для подключения к кластеру);
- в специальной области хранения метаданных на каждом [PDisk](../../../concepts/glossary.md#pdisk) (используется автоматической системой управления конфигурацией кластера для создания и применения новой конфигурации);
- в локальной базе таблетки [DS Controller](../../../concepts/glossary.md#ds-controller) (используется для хранения полученной от пользователя конфигурации и управления её распространением по кластеру);
- в локальной базе таблетки [CMS](../../../concepts/glossary.md#cms) (используется для просмотра конфигурации и её распространения в процессе работы по узлам кластера).

При [первоначальном развёртывании](../../deployment-options/manual/index.md) необходимо разместить конфигурационные файлы на всех [узлах хранения](../../../concepts/glossary.md#storage-node) и при помощи `ydbd node init --from-config config.yaml` подготовить директорию конфигурации, указать её в параметре `ydbd --config-dir`, запустить узлы кластера и затем передать этот же конфигурационный файл в систему автоматического управления конфигурацией кластера с помощью специальной команды. Система [распределённой конфигурации](../../../concepts/glossary.md#distributed-configuration.md) доставит эту конфигурацию на узлы кластера и сохранит в специальной области хранения метаданных на PDisk, а также сохранит копию в DS Controller, CMS и в директориях конфигурации на узлах.

Для [обновления](#update-config) параметров необходимо также передать модифицированный файл конфигурации в систему автоматического управления конфигурацией при помощи специальной команды.

При [расширении кластера](cluster-expansion.md) необходимо загрузить конфигурационный файл на кластер с помощью специальной команды. На узлы, существовавшие до расширения, конфигурация будет доставлена автоматически системой [распределённой конфигурации](../../../concepts/glossary.md#distributed-configuration.md). После этого на запускаемых впервые [узлах хранения](../../../concepts/glossary.md#storage-node) перед их первым запуском необходимо разместить конфигурационные файлы, при помощи `ydbd node init --from-config config.yaml` подготовить директорию конфигурации и указать её в параметре `ydbd --config-dir`.

## Базовые сценарии использования

### Первоначальное развёртывание кластера {{ ydb-short-name }} {#initial-deployment}

Для конфигурации кластера при первоначальном развёртывании необходимо воспользоваться соответствующими инструкциями в зависимости от предпочитаемого способа управления инфраструктурой:

- [Развёртывание с помощью Ansible](../../deployment-options/ansible/index.md);
- [Развёртывание вручную](../../deployment-options/manual/index.md).

### Обновление конфигурации {#update-config}

Для обновления конфигурации на уже развёрнутом кластере необходимо воспользоваться соответствующими командами в зависимости от способа развёртывания:

- [Обновление конфигурации для кластера, развёрнутого с помощью Ansible](../../deployment-options/ansible/update-config.md);
- [Обновление конфигурации для кластера, развёрнутого вручную](../../deployment-options/manual/update-config.md).

Если изменения конфигурации затрагивают параметры, требующие перезапуска узлов кластера, воспользуйтесь процедурой [rolling restart](../../../reference/ydbops/rolling-restart-scenario.md). Подробнее о ней в зависимости от способа развёртывания:

* [Перезапуск кластера, развёрнутого с помощью Ansible](../../deployment-options/ansible/restart.md);
* [Перезапуск кластера, развёрнутого вручную](../../../reference/ydbops/rolling-restart-scenario.md).

## Смотрите также

* [Добавление новых узлов в кластер](cluster-expansion.md).
* [Справка по параметрам конфигурации](config-settings.md).