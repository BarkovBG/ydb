name: Regression-whitelist-run

on:
  schedule:
    - cron: "0 23 * * *"  # At 23:00 every day
  workflow_dispatch:

jobs:
  main:
    name: Whitelist-run
    strategy:
      fail-fast: false
      matrix:
        # Используем github.ref для launch вручную, или устанавливаем статический набор веток для запуска по расписанию
        branch: ${{ fromJSON(format('["{0}"]', github.event_name == 'workflow_dispatch' ? github.ref : 'main, stable-25-1, stable-25-1-1').replace(', ', '","')) }}
        build_preset: ["relwithdebinfo", "release-asan", "release-tsan", "release-msan"]
    steps:
      - name: Run tests
        uses: ./.github/workflows/run_tests.yml
        secrets: inherit
        with:
          test_targets: ydb/tests/sql/ ydb/tests/stress ydb/tests/functional/tpc ydb/tests/functional/benchmarks_init
          ref: ${{ matrix.branch }}
          build_preset: ${{ matrix.build_preset }}